---
title: "String manipulation and date parsing"
output: github_document
---

*Aim: Learn how to extract information from strings (text and character data) using regular expressions*

We will look at some built-in fucntions for working with strings (`substr`, `strsplit`, `paste`) as well as their Tidy equivalents from the [`tidyr`](https://tidyr.tidyverse.org) and [`stringr`](https://stringr.tidyverse.org) packages. See also: [R For Data Science Chapter 14: Strings](https://r4ds.had.co.nz/strings.html).

# String manipulation

A "string" is a sequence of symbols. In computer languages, strings are typically a data structure for storing text information as a sequence of letters, numbers, punctuation, and other language symbols. In R and most programming languages, strings are demarcated by surrounding them by single `'` or double `"` quotation marks.

```{r}
"I like cats."
"Áå´„ÅåÂ§ßÂ•Ω„Åç„ÄÇ"
```

In R, single or double quotation marks are functionally equivalent but they have different meanings in other languages. For example in the C programming language, single quotes are used to demarcate single characters while double quotes must be used for strings. In bash, a string in single quotes will be interpreted literally (as-is):

```{bash}
echo 'Hi, $USER, the date is $(date +%Y-%m-%d)'
```
while a string in double quotes allows string interpolation (where bash will look through the string for meaningful punctuation and interpret it as a command)
```{bash}
echo "Hi, $USER, the date is $(date +%Y-%m-%d)"
```

In R, strings are stored as type `character`
```{r}
typeof("Hello, World")
```

Outside of string processing and text data storage, the main place in R that `character` data shows up is in indexing into named elements of vectors and lists (including `data.frame`s). E.g., a named vector:

```{r}
sample_sizes <- c(cases=11795, controls=14084)
```

The elements can either be indexed with string _literals_
```{r}
sample_sizes[["cases"]]
sample_sizes[["controls"]]
```

or with a variable assigned the value we want to extract
```{r}
a <- "cases"
sample_sizes[[a]]
```

## String escapes

The majority of alphabetic, numeric, and punctuation characters are represented in a string just as they appear. Strings can also contain special characters take on a meaning other than a literal character. These are called "escape characters" (or, if they involve more than one character, "escape sequences") and are prepended with `\` (backslash). The most common escape characters that you'll encounter in data processing are:

- `\"` and `\'` to specify a double or single quote within a string.
```{r}
"This double-quoted string needs to escape \"double\" quotes"
'This single-quoted string needs to escape \'single\' quotes'
```
- `\n` for line breaks (newline)
```{r}
string_with_newlines <- "This\nstring\nhas\nseveral\nlines."
```
- `\t` for tabs
```{r}
string_with_tabs <- "This\tstring\tis\ttab\tseparated"
```
- `\u` and `\U` for Unicode characters.
```{r}
string_with_unicode <- "\U0001f978"
```


# Displaying strings

When echoed in the terminal, strings in R will be output just as they appear in the source code, exactly as they were typed, including the escape characters. To print an interpreted version of the string to the screen, use the `cat()` function:

**Newlines**
```{r}
string_with_newlines
cat(string_with_newlines)
```

**Tabs**
```{r}
string_with_tabs
cat(string_with_tabs)
```

**Unicode**
```{r}
string_with_unicode
cat(string_with_unicode)
"üíÄüëªüê∂üê±"
cat("üíÄüëªüê∂üê±")
```

## Built-in commands

Three common operations that it is worthwhile knowing the built-in commands for are counting, subsetting, splitting, and combining strings.

### Getting information about strings (`nchar`)

The number of characters in a string can be calculated with `nchar`

```{r}
nchar("hello")
```
This function can also processing vectors of characters
```{r}
nchar(c("hello", "abracadabra"))
```

**Quick question**: What information is `length("hello")` returning?

### Subsetting strings (`substr`)

Parts of a string can be extracted by character position using `subtr` (substring). The third, fourth, and fifth characters of the word "hello" can be extracted with
```{r}
substr("hello", start=3, stop=5)
```
Getting a part of a string using position is useful if all of the strings you want to work with are of uniform length and formatting. For example if you have a list of ICD-10 diagnoses:

```{r}
icd10 <- c("F410", "F322", "I119", "E112")
```
and you want to extract information about which chapter the diagnoses are from
```{r}
table(substr(icd10, 1, 1))
```

`substr` can also be used for assignment
```{r}
classic_pub <- "The Sheep Head Inn"
substr(classic_pub, 13, 13) <- 'i'
classic_pub
```

### Cleaning up whitespace (`trimws`)

### String substitution (`gsub`)

### String transformation (`toupper` and `tolower`)

### String separation (`strsplit`)

### String concatenation (`paste`)

## Tidyverse: `stringr`

# Parsing dates (`lubridate`)

